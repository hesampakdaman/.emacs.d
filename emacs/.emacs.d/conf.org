* general
#+BEGIN_SRC emacs-lisp
  (use-package general
    :init
    (general-auto-unbind-keys))
#+END_SRC
* emms
#+BEGIN_SRC emacs-lisp
  (use-package emms
    :config
    (emms-all)
    (emms-default-players))
#+END_SRC
* calendar
#+BEGIN_SRC emacs-lisp
  ;; start with Mon
  (setq calendar-week-start-day 1)

  ;; EU style
  (setq calendar-date-style 'european)

  ;; Date format
  (setq calendar-date-display-form
        '((if dayname
              (concat dayname ", "))
          day " " monthname " " year))

  ;; 24-clock
  (setq calendar-time-display-form
        '(24-hours ":" minutes))

  ;; show week numbers
  (setq calendar-intermonth-text
        '(propertize
          (format "W%2d"
                  (car
                   (calendar-iso-from-absolute
                    (calendar-absolute-from-gregorian (list month day year)))))
          'font-lock-face 'calendar-iso-week-face))
#+END_SRC
* minor modes
** winner-mode
#+BEGIN_SRC emacs-lisp
  (winner-mode 1)
#+END_SRC
** prog
*** highlight
**** whitespace
Colorize characters for long lines in python and C.
#+BEGIN_SRC emacs-lisp
  (use-package whitespace
    :config
    (setq whitespace-line-column 120)
    (setq whitespace-style '(face lines-tail))
    (add-hook 'c-mode-hook 'whitespace-mode)
    (add-hook 'c++-mode-hook 'whitespace-mode)
    (add-hook 'python-mode-hook 'whitespace-mode))
#+END_SRC
*** ws-butler
Removes trailing space and tabs from this user modified lines.
#+BEGIN_SRC emacs-lisp
  (use-package ws-butler)
  (add-hook 'prog-mode-hook #'ws-butler-mode)
#+END_SRC
*** hideshow
#+BEGIN_SRC emacs-lisp
  (setq hs-allow-nesting t)
  (add-hook 'prog-mode-hook 'hs-minor-mode)
  (eval-after-load 'prog-mode
    '(define-key prog-mode-map (kbd "C-<return>") 'hs-toggle-hiding))
#+END_SRC
*** row/column/line numbers
#+BEGIN_SRC emacs-lisp
  (add-hook 'prog-mode-hook 'column-number-mode)
#+END_SRC
*** electric mode
Will add closing brackets and indent code accordingly.
#+BEGIN_SRC emacs-lisp
  (defun hesam/electric ()
    (electric-pair-local-mode t)
    (electric-indent-local-mode t))
  (add-hook 'prog-mode-hook #'hesam/electric)
#+END_SRC
** motion
*** avy
#+BEGIN_SRC emacs-lisp
  (use-package avy
    :ensure t
    :bind
    ("C-'" . 'avy-goto-char-2)
    ("M-g f" . 'avy-goto-line))
#+END_SRC
*** subword
#+BEGIN_SRC emacs-lisp
  (global-subword-mode 1)
#+END_SRC
** editing
*** copying/pasting
#+BEGIN_SRC emacs-lisp
  (defun copy-line (arg)
    "Copy lines (as many as prefix argument) in the kill ring.
        Ease of use features:
        - Move to start of next line.
        - Appends the copy on sequential calls.
        - Use newline as last char even on the last line of the buffer.
        - If region is active, copy its lines."
    (interactive "p")
    (let ((beg (line-beginning-position))
          (end (line-end-position arg)))
      (when mark-active
        (if (> (point) (mark))
            (setq beg (save-excursion (goto-char (mark)) (line-beginning-position)))
          (setq end (save-excursion (goto-char (mark)) (line-end-position)))))
      (if (eq last-command 'copy-line)
          (kill-append (buffer-substring beg end) (< end beg))
        (kill-ring-save beg end)))
    (kill-append "\n" nil)
    (beginning-of-line (or (and arg (1+ arg)) 2))
    (if (and arg (not (= 1 arg))) (message "%d lines copied" arg)))
  (global-set-key (kbd "C-c C-k") 'copy-line)
#+END_SRC
*** deletion
#+BEGIN_SRC emacs-lisp
  (defun hesam/kill-a-word (&optional args)
    (interactive "p")
    (forward-char 1)			;if at beg. of word
    (backward-word 1)
    (kill-word args)
    )
  (global-set-key (kbd "C-c d") 'hesam/kill-a-word)
#+END_SRC
*** transpose
#+BEGIN_SRC emacs-lisp
  (use-package transpose-mark
    :ensure t
    :bind ("C-x m" . 'transpose-mark-region))
#+END_SRC
*** sudo-edit
#+BEGIN_SRC emacs-lisp
  (use-package sudo-edit
    :ensure t)
#+END_SRC
** smartparens
#+BEGIN_SRC emacs-lisp
  (use-package smartparens
    :requires 'smartparens-config
    :config
    (add-hook 'python-mode-hook #'smartparens-mode))
#+END_SRC
** dired
*** dired-rsync
#+BEGIN_SRC emacs-lisp
  (use-package dired-rsync
    :ensure t
    :config
    (bind-key "C-c C-r" 'dired-rsync dired-mode-map))
#+END_SRC
*** dired-do-eshell
[[https://emacs.stackexchange.com/questions/30855/how-to-grep-marked-files-in-the-dired-mode-of-emacs][Stackoverflow]]
#+BEGIN_SRC emacs-lisp
  (defun dired-do-eshell-command (command)
    "Run an Eshell command on the marked files."
    (interactive "sEshell command: ")
    (let ((files (dired-get-marked-files t)))
      (eshell-command
       (format "%s %s" command (mapconcat #'identity files " ")))))
#+END_SRC
*** dired-open-
[[http://stackoverflow.com/a/1110487/311660][Stackoverflow]] thread.
#+BEGIN_SRC emacs-lisp
  (defun my-dired-find-file (&optional arg)
    "Open each of the marked files, or the file under the point, or when prefix arg, the next N files "
    (interactive "P")
    (mapc 'find-file (dired-get-marked-files nil arg)))

  (define-key dired-mode-map "F" 'my-dired-find-file)
#+END_SRC
*** openwith
#+BEGIN_SRC emacs-lisp
  (use-package openwith
    :ensure t
    :config
    (setq openwith-associations
          (list
           (list (openwith-make-extension-regexp
                  '("mpg" "mpeg" "mp3" "mp4"
                    "avi" "wmv" "wav" "mov" "flv"
                    "ogm" "ogg" "mkv" "rar"))
                 "mpv"
                 '(file))
           (list (openwith-make-extension-regexp
                  '("doc" "xls" "ppt" "odt" "ods" "odg" "odp"))
                 "libreoffice"
                 '(file))))
    (openwith-mode 1))


#+END_SRC
** visual fill mode
#+BEGIN_SRC emacs-lisp
  (use-package visual-fill-column
    :ensure t)
  (add-hook 'visual-line-mode-hook #'visual-fill-column-mode)
  (setq fill-column 80)
#+END_SRC
** search
*** anzu
#+BEGIN_SRC emacs-lisp
  (use-package anzu
    :ensure t)
  (global-set-key [remap query-replace] 'anzu-query-replace)
  (global-set-key [remap query-replace-regexp] 'anzu-query-replace-regexp)
#+END_SRC
* appearance
#+begin_src emacs-lisp
  (org-babel-load-file
   (expand-file-name "appearance.org" user-emacs-directory))
#+end_src
* display
** Frame
#+BEGIN_SRC emacs-lisp
  (use-package transpose-frame
    :ensure t
    :bind ("C-x 4 t" . 'flop-frame))
#+END_SRC
* magit
#+BEGIN_SRC emacs-lisp
  (use-package magit
    :ensure t
    :bind ("C-x g" . magit-status))
#+END_SRC
* org mode
** init
 #+begin_SRC emacs-lisp
   (use-package org
     :general
     ("C-c l" 'org-store-link)
     ("C-c c" 'org-capture)
     ("C-c a" 'org-agenda)
     :init
     (setq org-src-window-setup 'current-window)
     (setq org-directory "~/Dropbox/org"))
      #+END_SRC
** templates
#+BEGIN_SRC emacs-lisp
  (setq org-capture-templates '(("t" "Todo [inbox]" entry
                                 (file+headline "~/Dropbox/org/agenda/inbox.org" "Inbox")
                                 "* TODO %i%?")
                                ("T" "Tickler" entry
                                 (file+headline "~/Dropbox/org/agenda/tickler.org" "Tickler")
                                 "* %i%? \n %U")))
#+END_SRC
** babel
#+BEGIN_SRC emacs-lisp
  (org-babel-do-load-languages
   'org-babel-load-languages
   '((C . t)
     (python . t)
     (shell . t)))
#+END_SRC
** agenda
*** files & keywords
#+BEGIN_SRC emacs-lisp
  (setq org-agenda-files '("~/Dropbox/org/agenda/gtd.org")
        org-default-notes-file "~/Dropbox/org/notes.org")
  (setq org-tag-alist '(("@work" . ?w) ("@home" . ?h)))
  (setq org-refile-targets '(("~/Dropbox/org/agenda/gtd.org" :maxlevel . 3)
                             ("~/Dropbox/org/agenda/someday.org" :level . 1)
                             ("~/Dropbox/org/agenda/tickler.org" :maxlevel . 2)))
  (setq org-refile-use-outline-path 'file)
  ;; makes org-refile outline working with helm/ivy
  (setq org-outline-path-complete-in-steps nil)
  (setq org-refile-allow-creating-parent-nodes 'confirm)
#+END_SRC
*** GTD
#+BEGIN_SRC emacs-lisp
  (defun hesam/inbox ()
    (interactive)
    (find-file-other-window (concat org-directory "/agenda/inbox.org")))

  (defun hesam/gtd ()
    (interactive)
    (find-file-other-window (concat org-directory "/agenda/gtd.org")))

  (defun hesam/tickler ()
    (interactive)
    (find-file-other-window (concat org-directory "/agenda/tickler.org")))

  (defun hesam/someday ()
    (interactive)
    (find-file-other-window (concat org-directory "/agenda/someday.org")))
#+END_SRC
*** view
Start with current day and do not show tasks that
are done.
#+BEGIN_SRC emacs-lisp
  (setq org-agenda-start-on-weekday nil
        org-agenda-skip-deadline-if-done t
        org-agenda-skip-scheduled-if-done t
        org-agenda-show-all-dates t)
#+END_SRC

From emacs cafe [[https://emacs.cafe/emacs/orgmode/gtd/2017/06/30/orgmode-gtd.html][blog]] to get gtd context filtered
in the dispatcher.
#+BEGIN_SRC emacs-lisp
  (setq org-agenda-custom-commands
        '(("w" "Context work" tags-todo "@work"
           ((org-agenda-overriding-header "Work")
            (org-agenda-skip-function #'my-org-agenda-skip-all-siblings-but-first)))
          ("h" "Context home" tags-todo "@home"
           ((org-agenda-overriding-header "Home")
            (org-agenda-skip-function #'my-org-agenda-skip-all-siblings-but-first)))))

  (defun my-org-agenda-skip-all-siblings-but-first ()
    "Skip all but the first non-done entry."
    (let (should-skip-entry)
      (unless (org-current-is-todo)
        (setq should-skip-entry t))
      (save-excursion
        (while (and (not should-skip-entry) (org-goto-sibling t))
          (when (org-current-is-todo)
            (setq should-skip-entry t))))
      (when should-skip-entry
        (or (outline-next-heading)
            (goto-char (point-max))))))

  (defun org-current-is-todo ()
    (string= "TODO" (org-get-todo-state)))
#+END_SRC
** appearance
*** org bullets
#+BEGIN_SRC emacs-lisp
  (use-package org-bullets
  :ensure t
  :config
  (add-hook 'org-mode-hook (lambda () (org-bullets-mode 1))))
#+END_SRC
*** misc
#+BEGIN_SRC emacs-lisp
  (setq org-startup-indented t
        org-pretty-entities t
        org-hide-emphasis-markers t
        org-agenda-block-separator ""
        org-fontify-whole-heading-line t
        org-fontify-done-headline t
        org-fontify-quote-and-verse-blocks t)
#+END_SRC
*** prettify
#+BEGIN_SRC emacs-lisp
  (add-hook 'org-mode-hook (lambda ()
     "Beautify Org Checkbox Symbol"
     (push '("[X]" . "✓") prettify-symbols-alist)
     (push '("[ ]" . "□") prettify-symbols-alist)
     (prettify-symbols-mode)))
#+END_SRC
* expand region
#+BEGIN_SRC emacs-lisp
(use-package expand-region
    :ensure t)
(global-set-key (kbd "C-=") 'er/expand-region)
#+END_SRC

* hydra
#+BEGIN_SRC emacs-lisp
(use-package hydra
    :ensure t)
#+END_SRC
* ace-window
#+BEGIN_SRC emacs-lisp
  (use-package ace-window
    :ensure t
    :bind ("s-o" . (lambda () (interactive) (ace-window 4))))
#+END_SRC
* bindings
** general
*** M-SPC (general)
#+BEGIN_SRC emacs-lisp
  (general-create-definer leader-super-spc
    :prefix "M-SPC")

  (leader-super-spc
    "b" 'hesam/book-folder-selector
    "p" 'macro/projectile
    "r" 'hesam/recipes
    "s" 'shell
    "c" 'hesam/start-calibre
    "t" 'hesam/theme-toggle
    "]" 'hesam/start-flameshot)
#+END_SRC
*** s-a (agenda)
#+BEGIN_SRC emacs-lisp
  (leader-super-spc
    "M-a a" 'org-agenda
    "M-a c" 'org-capture
    "M-a g" 'hesam/gtd
    "M-a l" 'hesam/ledger
    "M-a i" 'hesam/inbox
    "M-a s" 'hesam/someday
    "M-a t" 'hesam/tickler
    "M-a x" 'org-archive-subtree)

  (leader-super-spc
    :keymaps 'org-mode-map
    "M-a r" 'org-refile)
#+END_SRC
*** s-r
Bindings to control screen luminance.
#+BEGIN_SRC emacs-lisp
  (general-create-definer leader-super-r
    :prefix "s-r")

  (leader-super-r
    "d" 'hesam/day
    "n" 'hesam/night
    "s" 'hesam/dark)
#+END_SRC
** global
#+BEGIN_SRC emacs-lisp
  ;; completion suggestions
  (global-set-key (kbd "C-c h") 'hippie-expand)

  ;; ibuffer
  (global-set-key (kbd "C-x C-b") 'ibuffer)

  ;; disable suspend
  (global-unset-key (kbd "C-z"))
  (global-unset-key (kbd "C-x C-z"))
#+END_SRC
* server
#+BEGIN_SRC emacs-lisp
  (require 'server)
  (unless (server-running-p)
    (server-start))
#+END_SRC
* which-key
#+BEGIN_SRC emacs-lisp
  (use-package which-key
    :ensure t
    :config
    (which-key-mode))
#+END_SRC
* projectile
#+BEGIN_SRC emacs-lisp
  (use-package projectile
    :init
    (setq projectile-keymap-prefix (kbd "C-c p")
          projectile-completion-system 'default
          projectile-indexing-method 'alien)
    :config
    (projectile-global-mode))
#+END_SRC
* disabled
#+BEGIN_SRC emacs-lisp
  (put 'dired-find-alternate-file 'disabled nil)
  (put 'downcase-region 'disabled nil)
  (put 'suspend-frame 'disabled t)
  (put 'upcase-region 'disabled nil)
#+END_SRC
* company
General completion system.
#+BEGIN_SRC emacs-lisp
  (use-package company
    :ensure t
    :general
    ("C-c n" 'company-complete)
    :config
    (add-hook 'after-init-hook 'global-company-mode))
#+END_SRC
** company-shell
Specific module for shell scripting.
#+BEGIN_SRC emacs-lisp
  (use-package company-shell
    :config
    (add-to-list 'company-backends 'company-shell))
#+END_SRC
* sr-speedbar
#+BEGIN_SRC emacs-lisp
  (use-package sr-speedbar
    :ensure t
    :config
    (setq speedbar-use-images nil))
#+END_SRC
* pdf-tools
** init
#+BEGIN_SRC emacs-lisp
  (use-package pdf-tools
    :ensure t
    :config
    (pdf-tools-install)
    (define-key pdf-view-mode-map (kbd "C-s") 'isearch-forward)
    (define-key pdf-view-mode-map (kbd "C-r") 'isearch-backward))
#+END_SRC
** auxtex
#+BEGIN_SRC emacs-lisp
  ;; Use pdf-tools to open PDF files
  (setq TeX-view-program-selection '((output-pdf "PDF Tools"))
        TeX-source-correlate-start-server t)

  ;; Update PDF buffers after successful LaTeX runs
  (add-hook 'TeX-after-compilation-finished-functions
             #'TeX-revert-document-buffer)
#+END_SRC
** hooks
We disable beacon-mode since it causes blinking.
#+BEGIN_SRC emacs-lisp
  (add-hook 'pdf-view-mode-hook (lambda () (setq-local beacon-mode nil)))
#+END_SRC
** midnight mode
#+BEGIN_SRC emacs-lisp
  ;;; set colors for pdf-tools, the var expects cons
  ;; (setq pdf-view-midnight-colors (cons (doom-color 'fg) (doom-color 'bg)))
  (setq pdf-view-midnight-colors (cons "#ffffff" "#000000"))
#+END_SRC
* books
** selector
Choose a book folder in library and open notes.org.
#+BEGIN_SRC emacs-lisp
  (defun hesam/book-folder-selector ()
    (interactive)
    (hesam/book-open-notes (counsel-find-file "~/Dropbox/lib")))

  (defun hesam/book-open-notes (pth)
    (delete-other-windows)
    (dired pth)
    (find-file-other-window (concat pth "/notes.org"))
    (olivetti-mode)
    (windmove-left)
    (dired-mark-files-regexp "pdf$\\|epub$")
    (dired-next-marked-file 1 t)
    (dired-find-file))
#+END_SRC
** calibre
#+BEGIN_SRC emacs-lisp
  (defun hesam/start-calibre ()
    (interactive)
    (start-process "" nil "calibre"))

#+END_SRC
* nov
For reading epubs in beautiful format.
** setup
#+BEGIN_SRC emacs-lisp
  (use-package nov
    :config
    (add-to-list 'auto-mode-alist '("\\.epub\\'" . nov-mode))
    (define-key nov-mode-map (kbd "C-s") 'isearch-forward)
    (define-key nov-mode-map (kbd "C-r") 'isearch-backward)
    (define-key nov-mode-map (kbd "g") 'keyboard-quit)
    (define-key nov-mode-map (kbd "s") 'isearch-forward)
    (define-key nov-mode-map (kbd "r") 'isearch-backward)
    (define-key nov-mode-map (kbd "d") 'define-word-at-point)
    (define-key nov-mode-map (kbd "D") 'define-word)
    (define-key nov-mode-map (kbd "n") 'scroll-up)
    (define-key nov-mode-map (kbd "p") 'scroll-down)
    (define-key nov-mode-map (kbd "l") 'recenter-top-bottom)
    (define-key nov-mode-map (kbd "f") 'forward-word)
    (define-key nov-mode-map (kbd "b") 'backward-word)
    (define-key nov-mode-map (kbd "N") 'nov-next-document)
    (define-key nov-mode-map (kbd "P") 'nov-previous-document))
#+END_SRC
** rendering
#+BEGIN_SRC emacs-lisp
  (defun my-nov-font-setup ()
    (setq nov-text-width most-positive-fixnum
          visual-fill-column-center-text t
          olivetti-body-width 0.6)
    (visual-line-mode)
    (visual-fill-column-mode)
    (variable-pitch-mode)
    (olivetti-mode))

  (add-hook 'nov-mode-hook 'my-nov-font-setup)
#+END_SRC
* define-word
#+BEGIN_SRC emacs-lisp
  (use-package define-word
    :ensure t)
#+END_SRC
* redshift
#+BEGIN_SRC emacs-lisp
  (defun hesam/day ()
    (interactive)
    (shell-command "redshift -x")
    (message nil))

  (defun hesam/night ()
    (interactive)
    (shell-command "redshift -x; redshift -O 6500 -b 0.50")
    (message nil))

  (defun hesam/dark ()
    (interactive)
    (shell-command "redshift -x; redshift -O 6500 -b 0.30")
    (message nil))

  ;;; redshift mode based on time of day
  (if (> (string-to-number (format-time-string "%H")) 20)
      (hesam/night))
#+END_SRC
* prose
#+BEGIN_SRC emacs-lisp
  (defun hesam/prose ()
    (interactive)
    (setq org-hide-leading-stars nil)
    (face-remap-add-relative 'org-indent nil
                             :inherit '(org-hide fixed-pitch)
                             :height 0.1)
    (setq olivetti-body-width 0.6)
    (olivetti-mode)
    (org-restart-font-lock)
    (org-indent-mode -1)
    (variable-pitch-mode))
#+END_SRC
* olivetti
#+BEGIN_SRC emacs-lisp
  (use-package olivetti
    :ensure t)
#+END_SRC
* programs
** screenshot
#+BEGIN_SRC emacs-lisp
  (defun hesam/start-flameshot ()
    (interactive)
    (start-process-shell-command "" nil "flameshot gui"))
#+END_SRC
* eyebrowse
#+BEGIN_SRC emacs-lisp
  (use-package eyebrowse
    :config
    (eyebrowse-mode t))
#+END_SRC
* shx
#+BEGIN_SRC emacs-lisp
  (use-package shx
    :init
    (add-hook 'shell-mode-hook  #'shx-mode))
#+END_SRC
* shell
** completion
Consider completions other than for binaries.
#+BEGIN_SRC emacs-lisp
  (setq shell-completion-execonly nil)
#+END_SRC
* narrow
Enable region narrowing.
#+BEGIN_SRC emacs-lisp
(put 'narrow-to-region 'disabled nil)
#+END_SRC
* history
#+BEGIN_SRC emacs-lisp
  (savehist-mode 1)
#+END_SRC
* frames-only
Opens new buffers in a new frame. Place nicely with tiling wms.
#+BEGIN_SRC emacs-lisp
  (use-package frames-only-mode
    :config
    (frames-only-mode t))
#+END_SRC
* ediff
EXWM does not like the default option when using =ediff=,
 therefore we change it per the [[https://github.com/ch11ng/exwm/wiki][wiki]].
#+BEGIN_SRC emacs-lisp
  (setq ediff-window-setup-function 'ediff-setup-windows-plain)
#+END_SRC
* Loading untracked settings
Helper function hesam/load-if-exists to load any files if they
exist. These are not meant to be tracked by git. We also set the
custom-file variable to notifty emacs customization options not
tracked by git shall be saved there, instead of default in the init
file.
#+BEGIN_SRC emacs-lisp
  (defun hesam/load-if-exists (path)
    (if (file-exists-p path)
        (progn (load path))))

  (setq custom-file "~/.emacs.d/emacs-custom.el")
  (hesam/load-if-exists custom-file)
  (hesam/load-if-exists "~/.emacs.d/macros.el")
  (hesam/load-if-exists "~/.emacs.d/local.el")
#+END_SRC
* flyspell
** flyspell-correct-popup
#+BEGIN_SRC emacs-lisp
  (use-package flyspell-correct-popup
    :bind ("C-M-;" . flyspell-correct-wrapper)
    :init
    (setq flyspell-correct-interface #'flyspell-correct-popup))
#+END_SRC
* auto-revert
#+BEGIN_SRC emacs-lisp
  (auto-revert-mode)
#+END_SRC
* Regexp
#+BEGIN_SRC emacs-lisp
  (general-def
    "C-s" 'isearch-forward-regexp
    "C-r" 'isearch-backward-regexp)
#+END_SRC
* C
** style
#+BEGIN_SRC emacs-lisp
  (setq c-default-style '((java-mode . "java")
                          (awk-mode . "awk")
                          (other . "k&r")))
#+END_SRC
* py-autopep8
#+BEGIN_SRC emacs-lisp
  (use-package py-autopep8)
#+END_SRC
* ledger
Plain text double-entry bookkeeping.
#+BEGIN_SRC emacs-lisp
  (use-package ledger-mode)

  (defun hesam/ledger ()
    (interactive)
    (find-file-other-window "~/Dropbox/ledger/ledger.dat"))
#+END_SRC
* flush-lines
#+BEGIN_SRC emacs-lisp
  (defun hesam/remove-blank-lines ()
    (interactive)
    (flush-lines "^$"))
#+END_SRC
* minions
Will hide all minor-modes, shown in mode-line, in a list.
#+BEGIN_SRC emacs-lisp
  (use-package minions
    :config (minions-mode 1))
#+END_SRC
* bookmarks
Saving bookmarks to Dropbox and auto-saving upon change.
#+BEGIN_SRC emacs-lisp
  (setq bookmark-default-file "~/Dropbox/emacs/bookmarks"
        ;; num changes before saving bookmark
        bookmark-save-flag 1)
#+END_SRC
* deft
** setup
#+BEGIN_SRC emacs-lisp
  (use-package deft
    :commands (deft)
    :config  (setq deft-file-naming-rules	;; use dots as delimiters in filename and downcase
                   '((noslash . ".")
                     (nospace . ".")
                     (case-fn . downcase))
                   deft-use-filename-as-title nil
                   deft-use-filter-string-for-filename t
                   deft-extensions '("org")
                   deft-default-extension "org"))
#+END_SRC
** director
Chooses which directory to run deft in. Courtesy of [[http://pragmaticemacs.com/category/deft/][bjm]].
#+BEGIN_SRC emacs-lisp
  (defun hesam/deft-director (dir)
    "Run deft in directory DIR"
    (setq deft-directory dir)
    (switch-to-buffer "*Deft*")
    (kill-this-buffer)
    (deft))
#+END_SRC
** projects
#+BEGIN_SRC emacs-lisp
  (defun hesam/recipes ()
    (interactive)
    (hesam/deft-director "~/Dropbox/org/recipes"))

  (defun hesam/notes ()
    (interactive)
    (hesam/deft-director "~/Dropbox/org/notes"))
#+END_SRC
* backups
Saves all backups to =~/.emacs.d/backups= and in addition creates numbered
#+begin_src emacs-lisp
  (setq backup-directory-alist `(("." . "~/.emacs.d/backups")))
  (setq delete-old-versions t
        kept-new-versions 5
        version-control t)
#+end_src
* orderless
#+BEGIN_SRC emacs-lisp
  (use-package orderless
    :init
    (setq completion-styles '(orderless)
          completion-category-defaults nil
          completion-category-overrides '((file (styles partial-completion)))))
#+END_SRC
* vertico
#+BEGIN_SRC emacs-lisp
  (use-package vertico
    :init
    (vertico-mode))

  ;; Use `consult-completion-in-region' if Vertico is enabled.
  ;; Otherwise use the default `completion--in-region' function.
  (setq completion-in-region-function
        (lambda (&rest args)
          (apply (if vertico-mode
                     #'consult-completion-in-region
                   #'completion--in-region)
                 args)))
#+END_SRC
* consult
#+BEGIN_SRC emacs-lisp
  (use-package consult
    ;; Replace bindings. Lazily loaded due by `use-package'.
    :bind (;; C-c bindings (mode-specific-map)
           ("C-c k" . consult-kmacro)
           ;; C-x bindings (ctl-x-map)
           ("C-x b" . consult-buffer)                ;; orig. switch-to-buffer
           ("C-x 4 b" . consult-buffer-other-window) ;; orig. switch-to-buffer-other-window
           ("C-x 5 b" . consult-buffer-other-frame)  ;; orig. switch-to-buffer-other-frame
           ;; Custom M-# bindings for fast register access
           ;; Other custom bindings
           ("M-y" . consult-yank-pop)                ;; orig. yank-pop
           ;; M-g bindings (goto-map)
           ("M-g e" . consult-compile-error)
           ("M-g f" . consult-flymake)               ;; Alternative: consult-flycheck
           ("M-g g" . consult-goto-line)             ;; orig. goto-line
           ("M-g M-g" . consult-goto-line)           ;; orig. goto-line
           ("M-g o" . consult-outline)               ;; Alternative: consult-org-heading
           ("M-g m" . consult-mark)
           ("M-g k" . consult-global-mark)
           ("M-g i" . consult-imenu)
           ("M-g I" . consult-imenu-multi)
           ;; M-s bindings (search-map)
           ("M-s f" . consult-find)
           ("M-s F" . consult-locate)
           ("M-s g" . consult-grep)
           ("M-s G" . consult-git-grep)
           ("M-s r" . consult-ripgrep)
           ("M-s l" . consult-line)
           ("M-s L" . consult-line-multi)
           ("M-s m" . consult-multi-occur)
           ("M-s k" . consult-keep-lines)
           ("M-s u" . consult-focus-lines)
           ;; Isearch integration
           ("M-s e" . consult-isearch)
           :map isearch-mode-map
           ("M-e" . consult-isearch)                 ;; orig. isearch-edit-string
           ("M-s e" . consult-isearch)               ;; orig. isearch-edit-string
           ("M-s l" . consult-line)                  ;; needed by consult-line to detect isearch
           ("M-s L" . consult-line-multi))           ;; needed by consult-line to detect isearch
    :init
    ;; Optionally replace `completing-read-multiple' with an enhanced version.
    (advice-add #'completing-read-multiple :override #'consult-completing-read-multiple)

    ;; Use Consult to select xref locations with preview
    (setq xref-show-xrefs-function #'consult-xref
          xref-show-definitions-function #'consult-xref))
#+END_SRC
